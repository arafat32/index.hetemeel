jQuery.trumbowyg={langs:{en:{viewHTML:"View HTML",undo:"Undo",redo:"Redo",formatting:"Formatting",p:"Paragraph",blockquote:"Quote",code:"Code",header:"Header",bold:"Bold",italic:"Italic",strikethrough:"Stroke",underline:"Underline",strong:"Strong",em:"Emphasis",del:"Deleted",superscript:"Superscript",subscript:"Subscript",unorderedList:"Unordered list",orderedList:"Ordered list",insertImage:"Insert Image",link:"Link",createLink:"Insert link",unlink:"Remove link",justifyLeft:"Align Left",justifyCenter:"Align Center",justifyRight:"Align Right",justifyFull:"Align Justify",horizontalRule:"Insert horizontal rule",removeformat:"Remove format",fullscreen:"Fullscreen",close:"Close",submit:"Confirm",reset:"Cancel",required:"Required",description:"Description",title:"Title",text:"Text",target:"Target",width:"Width"}},plugins:{},svgPath:null,hideButtonTexts:null},Object.defineProperty(jQuery.trumbowyg,"defaultOptions",{value:{lang:"en",fixedBtnPane:!1,fixedFullWidth:!1,autogrow:!1,autogrowOnEnter:!1,imageWidthModalEdit:!1,prefix:"trumbowyg-",semantic:!0,resetCss:!1,removeformatPasted:!1,tagsToRemove:[],tagsToKeep:["hr","img","embed","iframe","input"],btns:[["viewHTML"],["undo","redo"],["formatting"],["strong","em","del"],["superscript","subscript"],["link"],["insertImage"],["justifyLeft","justifyCenter","justifyRight","justifyFull"],["unorderedList","orderedList"],["horizontalRule"],["removeformat"],["fullscreen"]],btnsDef:{},inlineElementsSelector:"a,abbr,acronym,b,caption,cite,code,col,dfn,dir,dt,dd,em,font,hr,i,kbd,li,q,span,strikeout,strong,sub,sup,u",pasteHandlers:[],plugins:{},urlProtocol:!1,minimalLinks:!1},writable:!1,enumerable:!0,configurable:!1}),function(h,f,p,m){"use strict";var c="tbwconfirm",u="tbwcancel";m.fn.trumbowyg=function(e,t){var n="trumbowyg";if(e===Object(e)||!e)return this.each(function(){m(this).data(n)||m(this).data(n,new o(this,e))});if(1===this.length)try{var a=m(this).data(n);switch(e){case"execCmd":return a.execCmd(t.cmd,t.param,t.forceCss);case"openModal":return a.openModal(t.title,t.content);case"closeModal":return a.closeModal();case"openModalInsert":return a.openModalInsert(t.title,t.fields,t.callback);case"saveRange":return a.saveRange();case"getRange":return a.range;case"getRangeText":return a.getRangeText();case"restoreRange":return a.restoreRange();case"enable":return a.setDisabled(!1);case"disable":return a.setDisabled(!0);case"toggle":return a.toggle();case"destroy":return a.destroy();case"empty":return a.empty();case"html":return a.html(t)}}catch(e){}return!1};var o=function(e,t){var n=this,a="trumbowyg-icons",o=m.trumbowyg;n.doc=e.ownerDocument||p,n.$ta=m(e),n.$c=m(e),null!=(t=t||{}).lang||null!=o.langs[t.lang]?n.lang=m.extend(!0,{},o.langs.en,o.langs[t.lang]):n.lang=o.langs.en,n.hideButtonTexts=null!=o.hideButtonTexts?o.hideButtonTexts:t.hideButtonTexts;var r=null!=o.svgPath?o.svgPath:t.svgPath;if(n.hasSvg=!1!==r,n.svgPath=n.doc.querySelector("base")?f.location.href.split("#")[0]:"",0===m("#"+a,n.doc).length&&!1!==r){if(null==r){for(var i=p.getElementsByTagName("script"),s=0;s<i.length;s+=1){var l=i[s].src,d=l.match("trumbowyg(.min)?.js");null!=d&&(r=l.substring(0,l.indexOf(d[0]))+"ui/icons.svg")}null==r&&console.warn("You must define svgPath: https://goo.gl/CfTY9U")}var c=n.doc.createElement("div");c.id=a,n.doc.body.insertBefore(c,n.doc.body.childNodes[0]),m.ajax({async:!0,type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",dataType:"xml",crossDomain:!0,url:r,data:null,beforeSend:null,complete:null,success:function(e){c.innerHTML=(new XMLSerializer).serializeToString(e.documentElement)}})}function u(){return(f.chrome||f.Intl&&Intl.v8BreakIterator)&&"CSS"in f}var g=n.lang.header;n.btnsDef={viewHTML:{fn:"toggle",class:"trumbowyg-not-disable"},undo:{isSupported:u,key:"Z"},redo:{isSupported:u,key:"Y"},p:{fn:"formatBlock"},blockquote:{fn:"formatBlock"},h1:{fn:"formatBlock",title:g+" 1"},h2:{fn:"formatBlock",title:g+" 2"},h3:{fn:"formatBlock",title:g+" 3"},h4:{fn:"formatBlock",title:g+" 4"},subscript:{tag:"sub"},superscript:{tag:"sup"},bold:{key:"B",tag:"b"},italic:{key:"I",tag:"i"},underline:{tag:"u"},strikethrough:{tag:"strike"},strong:{fn:"bold",key:"B"},em:{fn:"italic",key:"I"},del:{fn:"strikethrough"},createLink:{key:"K",tag:"a"},unlink:{},insertImage:{},justifyLeft:{tag:"left",forceCss:!0},justifyCenter:{tag:"center",forceCss:!0},justifyRight:{tag:"right",forceCss:!0},justifyFull:{tag:"justify",forceCss:!0},unorderedList:{fn:"insertUnorderedList",tag:"ul"},orderedList:{fn:"insertOrderedList",tag:"ol"},horizontalRule:{fn:"insertHorizontalRule"},removeformat:{},fullscreen:{class:"trumbowyg-not-disable"},close:{fn:"destroy",class:"trumbowyg-not-disable"},formatting:{dropdown:["p","blockquote","h1","h2","h3","h4"],ico:"p"},link:{dropdown:["createLink","unlink"]}},n.o=m.extend(!0,{},o.defaultOptions,t),n.o.hasOwnProperty("imgDblClickHandler")||(n.o.imgDblClickHandler=n.getDefaultImgDblClickHandler()),n.urlPrefix=n.setupUrlPrefix(),n.disabled=n.o.disabled||"TEXTAREA"===e.nodeName&&e.disabled,t.btns?n.o.btns=t.btns:n.o.semantic||(n.o.btns[3]=["bold","italic","underline","strikethrough"]),m.each(n.o.btnsDef,function(e,t){n.addBtnDef(e,t)}),n.eventNamespace="trumbowyg-event",n.keys=[],n.tagToButton={},n.tagHandlers=[],n.pasteHandlers=[].concat(n.o.pasteHandlers),n.isIE=-1!==h.userAgent.indexOf("MSIE")||-1!==h.appVersion.indexOf("Trident/"),n.init()};o.prototype={DEFAULT_SEMANTIC_MAP:{b:"strong",i:"em",s:"del",strike:"del",div:"p",br:"p"},init:function(){var e=this;e.height=e.$ta.height(),e.initPlugins();try{e.doc.execCommand("enableObjectResizing",!1,!1),e.doc.execCommand("defaultParagraphSeparator",!1,"p")}catch(e){}e.buildEditor(),e.buildBtnPane(),e.fixedBtnPaneEvents(),e.buildOverlay(),setTimeout(function(){e.disabled&&e.setDisabled(!0),e.$c.trigger("tbwinit")})},addBtnDef:function(e,t){this.btnsDef[e]=t},setupUrlPrefix:function(){var e=this.o.urlProtocol;if(e)return"string"!=typeof e?"https://":/:\/\/$/.test(e)?e:e+"://"},buildEditor:function(){var a=this,t=a.o.prefix,e="";a.$box=m("<div/>",{class:t+"box "+t+"editor-visible "+t+a.o.lang+" trumbowyg"}),a.isTextarea=a.$ta.is("textarea"),a.isTextarea?(e=a.$ta.val(),a.$ed=m("<div/>"),a.$box.insertAfter(a.$ta).append(a.$ed,a.$ta)):(a.$ed=a.$ta,e=a.$ed.html(),a.$ta=m("<textarea/>",{name:a.$ta.attr("id"),height:a.height}).val(e),a.$box.insertAfter(a.$ed).append(a.$ta,a.$ed),a.syncCode()),a.$ta.addClass(t+"textarea").attr("tabindex",-1),a.$ed.addClass(t+"editor").attr({contenteditable:!0,dir:a.lang._dir||"ltr"}).html(e),a.o.tabindex&&a.$ed.attr("tabindex",a.o.tabindex),a.$c.is("[placeholder]")&&a.$ed.attr("placeholder",a.$c.attr("placeholder")),a.$c.is("[spellcheck]")&&a.$ed.attr("spellcheck",a.$c.attr("spellcheck")),a.o.resetCss&&a.$ed.addClass(t+"reset-css"),a.o.autogrow||a.$ta.add(a.$ed).css({height:a.height}),a.semanticCode(),a.o.autogrowOnEnter&&a.$ed.addClass(t+"autogrow-on-enter");var n,o=!1,r=!1;a.$ed.on("dblclick","img",a.o.imgDblClickHandler).on("keydown",function(e){if((e.ctrlKey||e.metaKey)&&!e.altKey){o=!0;var t=a.keys[String.fromCharCode(e.which).toUpperCase()];try{return a.execCmd(t.fn,t.param),!1}catch(e){}}}).on("compositionstart compositionupdate",function(){r=!0}).on("keyup compositionend",function(e){if("compositionend"===e.type)r=!1;else if(r)return;var t,n=e.which;37<=n&&n<=40||(!e.ctrlKey&&!e.metaKey||89!==n&&90!==n?o||17===n||20===n?void 0===e.which&&a.semanticCode(!1,!1,!0):(t=!a.isIE||"compositionend"===e.type,a.semanticCode(!1,t&&13===n,!0),a.$c.trigger("tbwchange")):(a.semanticCode(!1,!0),a.$c.trigger("tbwchange")),setTimeout(function(){o=!1},50))}).on("mouseup keydown keyup",function(e){(e.ctrlKey||e.metaKey)&&!e.altKey||setTimeout(function(){o=!1},50),clearTimeout(n),n=setTimeout(function(){a.updateButtonPaneStatus()},50)}).on("focus blur",function(e){if(a.$c.trigger("tbw"+e.type),"blur"===e.type&&m("."+t+"active-button",a.$btnPane).removeClass(t+"active-button "+t+"active"),a.o.autogrowOnEnter){if(a.autogrowOnEnterDontClose)return;"focus"===e.type?(a.autogrowOnEnterWasFocused=!0,a.autogrowEditorOnEnter()):a.o.autogrow||(a.$ed.css({height:a.$ed.css("min-height")}),a.$c.trigger("tbwresize"))}}).on("cut drop",function(){setTimeout(function(){a.semanticCode(!1,!0),a.$c.trigger("tbwchange")},0)}).on("paste",function(n){if(a.o.removeformatPasted){n.preventDefault(),f.getSelection&&f.getSelection().deleteFromDocument&&f.getSelection().deleteFromDocument();try{var t=f.clipboardData.getData("Text");try{a.doc.selection.createRange().pasteHTML(t)}catch(e){a.doc.getSelection().getRangeAt(0).insertNode(a.doc.createTextNode(t))}a.$c.trigger("tbwchange",n)}catch(e){a.execCmd("insertText",(n.originalEvent||n).clipboardData.getData("text/plain"))}}m.each(a.pasteHandlers,function(e,t){t(n)}),setTimeout(function(){a.semanticCode(!1,!0),a.$c.trigger("tbwpaste",n),a.$c.trigger("tbwchange")},0)}),a.$ta.on("keyup",function(){a.$c.trigger("tbwchange")}).on("paste",function(){setTimeout(function(){a.$c.trigger("tbwchange")},0)}),a.$box.on("keydown",function(e){if(27===e.which&&1===m("."+t+"modal-box",a.$box).length)return a.closeModal(),!1})},autogrowEditorOnEnter:function(){var e=this;e.$ed.removeClass("autogrow-on-enter");var t=e.$ed[0].clientHeight;e.$ed.height("auto");var n=e.$ed[0].scrollHeight;e.$ed.addClass("autogrow-on-enter"),t!==n&&(e.$ed.height(t),setTimeout(function(){e.$ed.css({height:n}),e.$c.trigger("tbwresize")},0))},buildBtnPane:function(){var a=this,o=a.o.prefix,r=a.$btnPane=m("<div/>",{class:o+"button-pane"});m.each(a.o.btns,function(e,t){m.isArray(t)||(t=[t]);var n=m("<div/>",{class:o+"button-group "+(0<=t.indexOf("fullscreen")?o+"right":"")});m.each(t,function(e,t){try{a.isSupportedBtn(t)&&n.append(a.buildBtn(t))}catch(e){}}),0<n.html().trim().length&&r.append(n)}),a.$box.prepend(r)},buildBtn:function(e){var t,n,a,o=this,r=o.o.prefix,i=o.btnsDef[e],s=i.dropdown,l=null==i.hasIcon||i.hasIcon,d=o.lang[e]||e,c=m("<button/>",{type:"button",class:r+e+"-button "+(i.class||"")+(l?"":" "+r+"textual-button"),html:o.hasSvg&&l?'<svg><use xlink:href="'+o.svgPath+"#"+r+(i.ico||e).replace(/([A-Z]+)/g,"-$1").toLowerCase()+'"/></svg>':o.hideButtonTexts?"":i.text||i.title||o.lang[e]||e,title:(i.title||i.text||d)+(i.key?" (Ctrl + "+i.key+")":""),tabindex:-1,mousedown:function(){return s&&!m("."+e+"-"+r+"dropdown",o.$box).is(":hidden")||m("body",o.doc).trigger("mousedown"),(!o.$btnPane.hasClass(r+"disable")&&!o.$box.hasClass(r+"disabled")||m(this).hasClass(r+"active")||m(this).hasClass(r+"not-disable"))&&o.execCmd((!s?i.fn:"dropdown")||e,i.param||e,i.forceCss),!1}});return s?(c.addClass(r+"open-dropdown"),(n={class:(t=r+"dropdown")+"-"+e+" "+t+" "+r+"fixed-top"})["data-"+t]=e,a=m("<div/>",n),m.each(s,function(e,t){o.btnsDef[t]&&o.isSupportedBtn(t)&&a.append(o.buildSubBtn(t))}),o.$box.append(a.hide())):i.key&&(o.keys[i.key]={fn:i.fn||e,param:i.param||e}),s||(o.tagToButton[(i.tag||e).toLowerCase()]=e),c},buildSubBtn:function(e){var t=this,n=t.o.prefix,a=t.btnsDef[e],o=null==a.hasIcon||a.hasIcon;return a.key&&(t.keys[a.key]={fn:a.fn||e,param:a.param||e}),t.tagToButton[(a.tag||e).toLowerCase()]=e,m("<button/>",{type:"button",class:n+e+"-dropdown-button"+(a.ico?" "+n+a.ico+"-button":""),html:t.hasSvg&&o?'<svg><use xlink:href="'+t.svgPath+"#"+n+(a.ico||e).replace(/([A-Z]+)/g,"-$1").toLowerCase()+'"/></svg>'+(a.text||a.title||t.lang[e]||e):a.text||a.title||t.lang[e]||e,title:a.key?" (Ctrl + "+a.key+")":null,style:a.style||null,mousedown:function(){return m("body",t.doc).trigger("mousedown"),t.execCmd(a.fn||e,a.param||e,a.forceCss),!1}})},isSupportedBtn:function(e){try{return this.btnsDef[e].isSupported()}catch(e){}return!0},buildOverlay:function(){return this.$overlay=m("<div/>",{class:this.o.prefix+"overlay"}).appendTo(this.$box),this.$overlay},showOverlay:function(){m(f).trigger("scroll"),this.$overlay.fadeIn(200),this.$box.addClass(this.o.prefix+"box-blur")},hideOverlay:function(){this.$overlay.fadeOut(50),this.$box.removeClass(this.o.prefix+"box-blur")},fixedBtnPaneEvents:function(){var o=this,r=o.o.fixedFullWidth,i=o.$box;o.o.fixedBtnPane&&(o.isFixed=!1,m(f).on("scroll."+o.eventNamespace+" resize."+o.eventNamespace,function(){var e,t,n,a;i&&(o.syncCode(),e=m(f).scrollTop(),t=i.offset().top+1,a=(n=o.$btnPane).outerHeight()-2,0<e-t&&e-t-o.height<0?(o.isFixed||(o.isFixed=!0,n.css({position:"fixed",top:0,left:r?"0":"auto",zIndex:7}),m([o.$ta,o.$ed]).css({marginTop:n.height()})),n.css({width:r?"100%":i.width()-1+"px"}),m("."+o.o.prefix+"fixed-top",i).css({position:r?"fixed":"absolute",top:r?a:e-t+a+"px",zIndex:15})):o.isFixed&&(o.isFixed=!1,n.removeAttr("style"),m([o.$ta,o.$ed]).css({marginTop:0}),m("."+o.o.prefix+"fixed-top",i).css({position:"absolute",top:a})))}))},setDisabled:function(e){var t=this,n=t.o.prefix;(t.disabled=e)?t.$ta.attr("disabled",!0):t.$ta.removeAttr("disabled"),t.$box.toggleClass(n+"disabled",e),t.$ed.attr("contenteditable",!e)},destroy:function(){var e=this,t=e.o.prefix;e.isTextarea?e.$box.after(e.$ta.css({height:""}).val(e.html()).removeClass(t+"textarea").show()):e.$box.after(e.$ed.css({height:""}).removeClass(t+"editor").removeAttr("contenteditable").removeAttr("dir").html(e.html()).show()),e.$ed.off("dblclick","img"),e.destroyPlugins(),e.$box.remove(),e.$c.removeData("trumbowyg"),m("body").removeClass(t+"body-fullscreen"),e.$c.trigger("tbwclose"),m(f).off("scroll."+e.eventNamespace+" resize."+e.eventNamespace)},empty:function(){this.$ta.val(""),this.syncCode(!0)},toggle:function(){var e=this,t=e.o.prefix;e.o.autogrowOnEnter&&(e.autogrowOnEnterDontClose=!e.$box.hasClass(t+"editor-hidden")),e.semanticCode(!1,!0),setTimeout(function(){e.doc.activeElement.blur(),e.$box.toggleClass(t+"editor-hidden "+t+"editor-visible"),e.$btnPane.toggleClass(t+"disable"),m("."+t+"viewHTML-button",e.$btnPane).toggleClass(t+"active"),e.$box.hasClass(t+"editor-visible")?e.$ta.attr("tabindex",-1):e.$ta.removeAttr("tabindex"),e.o.autogrowOnEnter&&!e.autogrowOnEnterDontClose&&e.autogrowEditorOnEnter()},0)},dropdown:function(e){var t,n=this,a=n.doc,o=n.o.prefix,r=m("[data-"+o+"dropdown="+e+"]",n.$box),i=m("."+o+e+"-button",n.$btnPane),s=r.is(":hidden");m("body",a).trigger("mousedown"),s&&(t=i.offset().left,i.addClass(o+"active"),r.css({position:"absolute",top:i.offset().top-n.$btnPane.offset().top+i.outerHeight(),left:n.o.fixedFullWidth&&n.isFixed?t+"px":t-n.$btnPane.offset().left+"px"}).show(),m(f).trigger("scroll"),m("body",a).on("mousedown."+n.eventNamespace,function(e){r.is(e.target)||(m("."+o+"dropdown",n.$box).hide(),m("."+o+"active",n.$btnPane).removeClass(o+"active"),m("body",a).off("mousedown."+n.eventNamespace))}))},html:function(e){var t=this;return null!=e?(t.$ta.val(e),t.syncCode(!0),t.$c.trigger("tbwchange"),t):t.$ta.val()},syncTextarea:function(){var e=this;e.$ta.val(0<e.$ed.text().trim().length||0<e.$ed.find(e.o.tagsToKeep.join(",")).length?e.$ed.html():"")},syncCode:function(e){var t,n,a,o=this;!e&&o.$ed.is(":visible")?o.syncTextarea():(t=m("<div>").html(o.$ta.val()),n=m("<div>").append(t),m(o.o.tagsToRemove.join(","),n).remove(),o.$ed.html(n.contents().html())),o.o.autogrow&&(o.height=o.$ed.height(),o.height!==o.$ta.css("height")&&(o.$ta.css({height:o.height}),o.$c.trigger("tbwresize"))),o.o.autogrowOnEnter&&(o.$ed.height("auto"),(a=o.autogrowOnEnterWasFocused?o.$ed[0].scrollHeight:o.$ed.css("min-height"))!==o.$ta.css("height")&&(o.$ed.css({height:a}),o.$c.trigger("tbwresize")))},semanticCode:function(e,t,n){var a,o,r,i=this;i.saveRange(),i.syncCode(e),i.semanticTag("br"),i.o.semantic&&(i.semanticTag("b"),i.semanticTag("i"),i.semanticTag("s"),i.semanticTag("strike"),t&&(a=i.o.inlineElementsSelector,o=":not("+a+")",i.$ed.contents().filter(function(){return 3===this.nodeType&&0<this.nodeValue.trim().length}).wrap("<span data-tbw/>"),(r=function(e){var t,n;0!==e.length&&(n=(t=e.nextUntil(o).addBack().wrapAll("<p/>").parent()).nextAll(a).first(),t.next("br").remove(),r(n))})(i.$ed.children(a).first()),i.semanticTag("div",!0),this.o.semanticKeepParagraphs||i.$ed.find("p").filter(function(){return(!i.range||this!==i.range.startContainer)&&(0===m(this).text().trim().length&&0===m(this).children().not("br,span").length)}).contents().unwrap(),m("[data-tbw]",i.$ed).contents().unwrap()),n||i.restoreRange(),i.syncTextarea())},semanticTag:function(e,t){var n;if(null!=this.o.semantic&&"object"==typeof this.o.semantic&&this.o.semantic.hasOwnProperty(e))n=this.o.semantic[e];else{if(!0!==this.o.semantic||!this.DEFAULT_SEMANTIC_MAP.hasOwnProperty(e))return;n=this.DEFAULT_SEMANTIC_MAP[e]}m(e,this.$ed).each(function(){var e=m(this);if(0===e.contents().length)return!1;e.wrap("<"+n+"/>"),t&&m.each(e.prop("attributes"),function(){e.parent().attr(this.name,this.value)}),e.contents().unwrap()})},createLink:function(){for(var e,t,n,a,o,r=this,i=r.doc.getSelection(),s=i.focusNode,l=(new XMLSerializer).serializeToString(i.getRangeAt(0).cloneContents());["A","DIV"].indexOf(s.nodeName)<0;)s=s.parentNode;s&&"A"===s.nodeName&&(l=(n=m(s)).text(),a=n.attr("href"),r.o.minimalLinks||(e=n.attr("title"),t=n.attr("target")),(o=r.doc.createRange()).selectNode(s),i.removeAllRanges(),i.addRange(o)),r.saveRange();var d={url:{label:"URL",required:!0,value:a},text:{label:r.lang.text,value:l}};r.o.minimalLinks||Object.assign(d,{title:{label:r.lang.title,value:e},target:{label:r.lang.target,value:t}}),r.openModalInsert(r.lang.createLink,d,function(e){var t=r.prependUrlPrefix(e.url);if(!t.length)return!1;var n=m(['<a href="',t,'">',e.text||e.url,"</a>"].join(""));return r.o.minimalLinks||(0<e.title.length&&n.attr("title",e.title),0<e.target.length&&n.attr("target",e.target)),r.range.deleteContents(),r.range.insertNode(n[0]),r.syncCode(),r.$c.trigger("tbwchange"),!0})},prependUrlPrefix:function(e){if(!this.urlPrefix)return e;if(/^([a-z][-+.a-z0-9]*:|\/|#)/i.test(e))return e;return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)?"mailto:"+e:this.urlPrefix+e},unlink:function(){var e,t=this.doc.getSelection(),n=t.focusNode;if(t.isCollapsed){for(;["A","DIV"].indexOf(n.nodeName)<0;)n=n.parentNode;n&&"A"===n.nodeName&&((e=this.doc.createRange()).selectNode(n),t.removeAllRanges(),t.addRange(e))}this.execCmd("unlink",void 0,void 0,!0)},insertImage:function(){var n=this;n.saveRange();var e={url:{label:"URL",required:!0},alt:{label:n.lang.description,value:n.getRangeText()}};n.o.imageWidthModalEdit&&(e.width={}),n.openModalInsert(n.lang.insertImage,e,function(e){n.execCmd("insertImage",e.url,!1,!0);var t=m('img[src="'+e.url+'"]:not([alt])',n.$box);return t.attr("alt",e.alt),n.o.imageWidthModalEdit&&t.attr({width:e.width}),n.syncCode(),n.$c.trigger("tbwchange"),!0})},fullscreen:function(){var e,t=this.o.prefix,n=t+"fullscreen";this.$box.toggleClass(n),e=this.$box.hasClass(n),m("body").toggleClass(t+"body-fullscreen",e),m(f).trigger("scroll"),this.$c.trigger("tbw"+(e?"open":"close")+"fullscreen")},execCmd:function(t,n,e,a){var o=this;a=!!a||"","dropdown"!==t&&o.$ed.focus();try{o.doc.execCommand("styleWithCSS",!1,e||!1)}catch(e){}try{o[t+a](n)}catch(e){try{t(n)}catch(e){"insertHorizontalRule"===t?n=void 0:"formatBlock"===t&&o.isIE&&(n="<"+n+">"),o.doc.execCommand(t,!1,n),o.syncCode(),o.semanticCode(!1,!0)}"dropdown"!==t&&(o.updateButtonPaneStatus(),o.$c.trigger("tbwchange"))}},openModal:function(e,t){var n=this,a=n.o.prefix;if(0<m("."+a+"modal-box",n.$box).length)return!1;n.o.autogrowOnEnter&&(n.autogrowOnEnterDontClose=!0),n.saveRange(),n.showOverlay(),n.$btnPane.addClass(a+"disable");var o=m("<div/>",{class:a+"modal "+a+"fixed-top"}).css({top:n.$box.offset().top+n.$btnPane.height(),zIndex:99999}).appendTo(m(n.doc.body));n.$overlay.one("click",function(){return o.trigger(u),!1});var r=m("<form/>",{action:"",html:t}).on("submit",function(){return o.trigger(c),!1}).on("reset",function(){return o.trigger(u),!1}).on("submit reset",function(){n.o.autogrowOnEnter&&(n.autogrowOnEnterDontClose=!1)}),i=m("<div/>",{class:a+"modal-box",html:r}).css({top:"-"+n.$btnPane.outerHeight()+"px",opacity:0}).appendTo(o).animate({top:0,opacity:1},100);return m("<span/>",{text:e,class:a+"modal-title"}).prependTo(i),o.height(i.outerHeight()+10),m("input:first",i).focus(),n.buildModalBtn("submit",i),n.buildModalBtn("reset",i),m(f).trigger("scroll"),o},buildModalBtn:function(e,t){var n=this.o.prefix;return m("<button/>",{class:n+"modal-button "+n+"modal-"+e,type:e,text:this.lang[e]||e}).appendTo(m("form",t))},closeModal:function(){var e=this,t=e.o.prefix;e.$btnPane.removeClass(t+"disable"),e.$overlay.off();var n=m("."+t+"modal-box",m(p.body));n.animate({top:"-"+n.height()},100,function(){n.parent().remove(),e.hideOverlay()}),e.restoreRange()},openModalInsert:function(e,t,n){var s=this,i=s.o.prefix,l=s.lang,d="";return m.each(t,function(e,t){var n=t.label||e,a=t.name||e,o=t.attributes||{},r=Object.keys(o).map(function(e){return e+'="'+o[e]+'"'}).join(" ");d+='<label><input type="'+(t.type||"text")+'" name="'+a+'"'+("checkbox"===t.type&&t.value?' checked="checked"':' value="'+(t.value||"").replace(/"/g,"&quot;"))+'"'+r+'><span class="'+i+'input-infos"><span>'+(l[n]?l[n]:n)+"</span></span></label>"}),s.openModal(e,d).on(c,function(){var o=m("form",m(this)),r=!0,i={};m.each(t,function(e,t){var n=t.name||e,a=m('input[name="'+n+'"]',o);switch(a.attr("type").toLowerCase()){case"checkbox":i[n]=a.is(":checked");break;case"radio":i[n]=a.filter(":checked").val();break;default:i[n]=m.trim(a.val())}t.required&&""===i[n]?(r=!1,s.addErrorOnModalField(a,s.lang.required)):t.pattern&&!t.pattern.test(i[n])&&(r=!1,s.addErrorOnModalField(a,t.patternError))}),r&&(s.restoreRange(),n(i,t)&&(s.syncCode(),s.$c.trigger("tbwchange"),s.closeModal(),m(this).off(c)))}).one(u,function(){m(this).off(c),s.closeModal()})},addErrorOnModalField:function(e,t){var n=this.o.prefix,a=e.parent();e.on("change keyup",function(){a.removeClass(n+"input-error")}),a.addClass(n+"input-error").find("input+span").append(m("<span/>",{class:n+"msg-error",text:t}))},getDefaultImgDblClickHandler:function(){var o=this;return function(){var t=m(this),e=t.attr("src"),n="(Base64)";0===e.indexOf("data:image")&&(e=n);var a={url:{label:"URL",value:e,required:!0},alt:{label:o.lang.description,value:t.attr("alt")}};return o.o.imageWidthModalEdit&&(a.width={value:t.attr("width")?t.attr("width"):""}),o.openModalInsert(o.lang.insertImage,a,function(e){return e.url!==n&&t.attr({src:e.url}),t.attr({alt:e.alt}),o.o.imageWidthModalEdit&&(0<parseInt(e.width)?t.attr({width:e.width}):t.removeAttr("width")),!0}),!1}},saveRange:function(){var e,t,n,a=this,o=a.doc.getSelection();a.range=null,o&&o.rangeCount&&(e=a.range=o.getRangeAt(0),(t=a.doc.createRange()).selectNodeContents(a.$ed[0]),t.setEnd(e.startContainer,e.startOffset),n=(t+"").length,a.metaRange={start:n,end:n+(e+"").length})},restoreRange:function(){var e=this,t=e.metaRange,n=e.range,a=e.doc.getSelection();if(n){if(t&&t.start!==t.end)for(var o,r=0,i=[e.$ed[0]],s=!1,l=!1,d=e.doc.createRange();!l&&(o=i.pop());)if(3===o.nodeType){var c=r+o.length;!s&&t.start>=r&&t.start<=c&&(d.setStart(o,t.start-r),s=!0),s&&t.end>=r&&t.end<=c&&(d.setEnd(o,t.end-r),l=!0),r=c}else for(var u=o.childNodes,g=u.length;0<g;)--g,i.push(u[g]);a.removeAllRanges(),a.addRange(d||n)}},getRangeText:function(){return this.range+""},updateButtonPaneStatus:function(){var r=this,i=r.o.prefix,e=r.getTagsRecursive(r.doc.getSelection().focusNode),s=i+"active-button "+i+"active";m("."+i+"active-button",r.$btnPane).removeClass(s),m.each(e,function(e,t){var n=r.tagToButton[t.toLowerCase()],a=m("."+i+n+"-button",r.$btnPane);if(0<a.length)a.addClass(s);else try{var o=(a=m("."+i+"dropdown ."+i+n+"-dropdown-button",r.$box)).parent().data("dropdown");m("."+i+o+"-button",r.$box).addClass(s)}catch(e){}})},getTagsRecursive:function(n,a){var o=this;if(a=a||(n&&n.tagName?[n.tagName]:[]),!n||!n.parentNode)return a;var e=(n=n.parentNode).tagName;return"DIV"===e?a:("P"===e&&""!==n.style.textAlign&&a.push(n.style.textAlign),m.each(o.tagHandlers,function(e,t){a=a.concat(t(n,o))}),a.push(e),o.getTagsRecursive(n,a).filter(function(e){return null!=e}))},initPlugins:function(){var n=this;n.loadedPlugins=[],m.each(m.trumbowyg.plugins,function(e,t){t.shouldInit&&!t.shouldInit(n)||(t.init(n),t.tagHandler&&n.tagHandlers.push(t.tagHandler),n.loadedPlugins.push(t))})},destroyPlugins:function(){m.each(this.loadedPlugins,function(e,t){t.destroy&&t.destroy()})}}}(navigator,window,document,jQuery); 

!function(){"use strict";function e(e,i){for(var t=0;t<i.length;t++){var n=i[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}"undefined"!=typeof __webpack_require__&&Object.defineProperty(__webpack_require__,"p",{get:function(){try{if("string"!=typeof chunkCdnUrl)throw new Error("WebpackRequireFrom: 'chunkCdnUrl' is not a string or not available at runtime. See https://github.com/agoldis/webpack-require-from#troubleshooting");return chunkCdnUrl}catch(e){return console.error(e),"/"}},set:function(e){console.warn("WebpackRequireFrom: something is trying to override webpack public path. Ignoring the new value"+e+".")}});var i=function(){function i(){!function(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}(this,i)}var t,n,a;return t=i,a=[{key:"uploadedFileIcon",value:function(e){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],t=e.substring(e.lastIndexOf(".")+1).toLowerCase(),n="default";return _.indexOf(["doc","docx"],t)>=0?n="word":_.indexOf(["xls","xlsx","csv"],t)>=0?n="excel":_.indexOf(["ppt","pptx","pptm"],t)>=0?n="powerpoint":_.indexOf(["pdf"],t)>=0?n="pdf":_.indexOf(["txt","ini","cfg","rtf","html"],t)>=0?n="alt":_.indexOf(["php","js","cpp","css","scss","cs"],t)>=0?n="code":_.indexOf(["mp3","wav","flac","midi","aac"],t)>=0?n="audio":_.indexOf(["wmv","avi","mp4","flv","mov","mkv","mpeg"],t)>=0?n="video":_.indexOf(["zip","7z","rar","rar5","tar","gz","gzip"],t)>=0?n="archive":_.indexOf(["png","jpg","jpeg","gif","raw","tif","cdr","bmp","tiff","ai","eps","svg","dib"],t)>=0?n="image":_.indexOf(["psd"],t)>=0&&(n="psd"),"file-icon file-icon--".concat(n+=i?" file-icon--small":"")}},{key:"getExtension",value:function(e){return _.lowerCase(e.substring(_.lastIndexOf(e,".")+1))}}],(n=null)&&e(t.prototype,n),a&&e(t,a),Object.defineProperty(t,"prototype",{writable:!1}),i}();function t(e,t,n,a){var r,o,s,d,c=window.jQuery,u=t,f=n,p={},_=!0===a,h=function(){var t=c('<div class="file-item file-uploader__item">'),n=i.uploadedFileIcon(u.name,!0),a=c('<div class="file-item__name">').text(u.name),o=c('<div class="file-item__name-line">');o.append('<i class="file-item__ext '+n+'"></i>'),o.append(a),t.append(o);var s=c('<a class="file-item__action" title='+l("srcLegacyJsFileUploaderFileUploaderJs8","legacy-translations")+">");s.append('<i class="file-item__action-ico">'),t.append(s);var d=c('<div class="file-item__error hidden">');t.append(d);var h=c('<div class="file-item__loader" style="width: 0">');t.append('<div class="file-item__break" />'),t.append(h);var v=c('<input type="hidden" name="'+f.input.name+'[delete][]">'),g=c('<input type="hidden" name="'+f.input.name+'[new][]">');(p={$container:t,$name:a,$actionBtn:s,$deleteInput:v,$newInput:g,$error:d,$loader:h}).$actionBtn.on("click",(function(){if(_)$("error")||e.__totalFiles("dec"),y(_),void 0!==r&&0==r.status&&r.abort(),e.__removeFileBlock(u.name);else{if(p.$container.data("onDelete"))e.__totalFiles()<e.__maxFileCount()&&(e.__totalFiles("inc"),U());else{var i=e.__getOptions();if(i.deleteCallback){i.deleteCallback(u,(function(){L(),E()}))}else e.__totalFiles("dec"),C()}c(f.selector).trigger("fileUploader.change")}E()}))},v=function(){p.$loader.addClass("file-item__loader_success").animate({opacity:0}),p.$container.data("uploaded",!0);try{var i=JSON.parse(this.responseText)}catch(e){i={result:"error"}}"success"===i.result?F(i.file_id):(x("error"),k(i.reason),e.__totalFiles("dec"),O("success"))},g=function(){x("error"),k("default"),e.__totalFiles("dec")},m=function(e){var i=e.loaded/e.total*100^0;p.$loader.css("width",i+"%")},w=function(){O("abort")},F=function(e){e^=0,p.$newInput.val(e),p.$container.append(p.$newInput),O("success")},b=function(){return u.size<=s},y=function(e){p.$container.animate({opacity:0,height:0,margin:0},200,(function(){e&&(p.$container.remove(),p=null),c(f.selector).trigger("fileUploader.change"),E()}))},x=function(e){switch(e){case"deleted":p.$container.addClass("file-item_type_deleted");break;case"error":p.$container.addClass("file-item_type_error")}},$=function(e){switch(e){case"deleted":var i=p.$container.hasClass("file-item_type_deleted");break;case"error":i=p.$container.hasClass("file-item_type_error")}return i},k=function(e){var i=f.errors.default;f.errors[e]&&(i=f.errors[e]),p.$error.html(i).removeClass("hidden"),f.onError&&f.onError(i)},C=function(){u.id&&(x("deleted"),p.$container.append(p.$deleteInput),p.$deleteInput.val(u.id),p.$container.data("onDelete",!0))},U=function(){!function(e){switch(e){case"deleted":p.$container.removeClass("file-item_type_deleted");break;case"error":p.$container.removeClass("file-item_type_error")}}("deleted"),p.$deleteInput.detach(),p.$container.data("onDelete",!1)},O=function(e){o=e},L=function(){null!==p&&(p.$container.remove(),e.__totalFiles("dec"))},E=function(){f.onChange&&f.onChange()};return h(),s=1048576*f.maxSize,d=f.isMiniature||!1,{upload:function(){if(!b())return x("error"),k("file_size_exceed"),e.__totalFiles("dec"),!1;r=new XMLHttpRequest;var i=new FormData;i.append("upload_files",u),"undefined"!=typeof kworkLang&&i.append("lang",kworkLang),d||i.append("without_miniature",1),r.addEventListener("load",v),r.addEventListener("error",g),r.addEventListener("abort",w),r.upload.onprogress=m,r.open("POST","/api/file/upload",!0),O("load"),r.send(i)},get:function(){return p.$container},getFileName:function(){return u.name},status:function(){return o},destroy:L,hideError:function(){p.$error.html("").addClass("hidden")},checkError:function(){return p.$container.hasClass("file-item_type_error")},onChangeFile:E}}window.FileUploader=function(e){var i,n=window.jQuery,a={lang:{withFiles:l("srcLegacyJsFileUploaderFileUploaderJs1","legacy-translations"),withoutFiles:l("srcLegacyJsFileUploaderFileUploaderJs2","legacy-translations")},errors:{default:l("srcLegacyJsFileUploaderFileUploaderJs3","legacy-translations"),file_size_exceed:l("srcLegacyJsFileUploaderFileUploaderJs9","legacy-translations",[config.files.maxSize]),no_file_uploaded:l("srcLegacyJsFileUploaderFileUploaderJs4","legacy-translations"),not_allowed:l("srcLegacyJsFileUploaderFileUploaderJs5","legacy-translations"),user_non_authorized:l("srcLegacyJsFileUploaderFileUploaderJs6","legacy-translations"),invalid_filename:l("invalidFileName","components/file-uploader/file-uploader-module")},isMultiple:!0,maxFiles:config.files.maxCount,maxSize:config.files.maxSize},r={},o=0,s=[],d=!0;this.__construct=function(e){n.extend(a,e),n.extend(a.lang,{hint:l("maxFiles","components/file-uploader/file-uploader-module",{filesCount:a.maxFiles,size:a.maxSize})}),i=this,r.container=n(a.selector);var t=r.container.data("allowUpload");void 0!==t&&(d=!!t),f(),p(),_(),void 0!==a.files&&a.files.length?v(a.lang.withFiles):v(a.lang.withoutFiles),this.__setEvents()};var c=function(){return a.hasOwnProperty("isMultiple")&&!1===a.isMultiple?1:0^a.maxFiles};this.__maxFileCount=c;var u=function(e){return isNaN(o)&&(o=0),"inc"===e?(o++,n(window).trigger("changeFileCount.fileUploader")):"dec"===e&&(o=o<1?0:o-1,n(window).trigger("changeFileCount.fileUploader")),o>=c()?r.fileAddButton.hide():r.fileAddButton.show(),v(0==o?a.lang.withoutFiles:a.lang.withFiles),o};this.__totalFiles=u;var f=function(){var e=n('<input type="file" class="file-uploader__file-input">');a.isMultiple&&e.prop("multiple",!0),r.fileInput=e;var i=n('<label class="file-uploader__add d-flex_kwork-edit flex-wrap justify-content-between align-items-baseline">'),t=n('<div class="mr5 file-uploader__add-wrap">');t.append(r.fileInput),i.append(t),t.append('<i class="ico ico-clip file-uploader__add-ico"></i>');var l=n('<span class="file-uploader__add-text"></span>');if(t.append(l),a.lang.hasOwnProperty("hint")){var o=n('<span class="file-uploader__add-hint">'+a.lang.hint+"</span>");i.append(o)}r.fileAddButton=i,r.fileAddButtonLabel=l,r.container.append(i),d||r.fileAddButton.hide()},p=function(){r.loadFileList=n('<div class="load-file__list">'),r.container.append(r.loadFileList)};this.__setEvents=function(){var e=this;r.fileInput.on("change",(function(){v(a.lang.withFiles);for(var i=0;i<this.files.length;i++){if(u()>=c())break;if(this.files[i]){var l=new t(e,this.files[i],a,!0);r.loadFileList.append(l.get()),u("inc"),l.upload(),s.push(l)}}if(r.container.trigger("fileUploader.change"),n(this).val(""),!e.__canSave()){var o=setInterval((function(){e.__canSave()&&(clearInterval(o),e.__enableButton(),l.onChangeFile())}),100);return e.__disableButton(),l.onChangeFile(),!1}return!1}))};var _=function(){if(void 0!==a.files&&a.files.length)for(var e=0;e<a.files.length;e++){var n=a.files[e];if(n){var l=new t(i,n,a);r.loadFileList.append(l.get()),u("inc")}}},h=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(void 0!==a.files&&a.files.length)for(var n=0;n<a.files.length;n++){var l=a.files[n];if(l){a.isMiniature=!0;var o=new t(i,l,a,e);r.loadFileList.append(o.get()),u("inc"),s.push(o)}}},v=function(e){r.fileAddButtonLabel.text(e)};return this.__construct(e),this.__canSave=function(){for(var e=0;e<s.length;e++){var i=s[e];if("load"==i.status()||i.checkError())return!1}return!0},this.__hasErrors=function(){for(var e=0;e<s.length;e++){if(s[e].checkError())return!0}return!1},this.__canUpload=function(e){return"boolean"==typeof e&&(d=e,e?u():r.fileAddButton.hide()),d},this.__clear=function(){for(var e=Object.keys(s),i=0;i<e.length;i++){var t=e[i];s[t].destroy(),delete s[t]}return s=[],v(a.lang.withoutFiles),!0},this.__removeFileBlock=function(e){s=s.filter((function(i){return i.getFileName()!=e}))},this.__getOptions=function(){return a},this.__disableButton=function(){void 0!==a.buttonDisabled&&n(a.buttonDisabled).prop("disabled",!0).attr("disabled",!0).addClass("disabled btn_no-hover")},this.__enableButton=function(){void 0!==a.buttonDisabled&&n(a.buttonDisabled).prop("disabled",!1).attr("disabled",!1).removeClass("disabled btn_no-hover")},{totalFiles:u,hasErrors:this.__hasErrors,canSave:this.__canSave,canUpload:this.__canUpload,clear:this.__clear,update:function(e){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];a.files=e,h(i),void 0!==a.files&&a.files.length?v(a.lang.withFiles):v(a.lang.withoutFiles)}}}}();